#summary Evidence of the 80 / 90 percent principle

<font color="#0068b7">*Claiming that the 80% / 90% principle is widely used, and that the correct sizing of the buffers of token buckets is not performed by most users without proof is not good. As a result, we collected a lot of evidence and related discussions on the Internet.* </font>

There seem to be no formal studies about this topic, thus most discussions are from forums, blogs, and wiki pages of related products and open-source projects.

In the tables below, "shaping" stands for the token bucket rate for outgoing (tx) traffic, and "policing" for incoming (rx) traffic. Note that the "police" here does not necessarily mean that incoming traffic are policed with the "tc filter ... police ..." command; it can also be redirected to a virtual device, e.g., imq or ifb, and then be shaped with htb.

Some of the discussions include both traffic shaping and policing paramters; some scripts have introduced more complex strategies setting the token rate, and they can not be represented by a single percentage.

We can find that most of the suggested percentage is between 80% and 90%, and suggested buffer sizes of the token bucket algorithm include:

  * 128 packets
  * 1000 packets
  * 10240 packets
  * max(49 ms, 6.25 KB)
  * other (10 / 150 / 200 KB, 200 / 500 / 700 packets, 1000 ms)

=== Methodology for Collecting the Data ===

A lot of discussions come from the forums of 3rd-party open source projects like DD-WRT, OpenWRT, and Tomato. We first use the internal search function in these forums to locate the posts with keywords like:

  * QoS
  * Quality of Service
  * Bandwidth Control
  * Speed Limit
  * HTB
  * VoIP
  * BitTorrent

Then we did the same for discussions out of these forums with Google. The first 20 pages contain a lot of related discussions, but it then becomes quite difficult to find a related topic.

The search result from Google is not stable. As a result, the list may become quite different several years later. However, for such *anecdotal* evidence, it's the only way we can think of.

=== Different Approaches ===

In the calculator application, we can see that the token bucket parameters depend only on the link bandwidth. This strategy is based on numerous simulation experiments based on ns-2 that we have performed.

However, in some of the related discussions, we have also found different approaches. For example, in http://bbs.dualwan.cn/viewthread.php?tid=20122, it is suggested that:

token_rate = bandwidth `*` (30 + online_hosts) / (20 + online_hosts `*` 8)

We cannot find support for this equation. It seems to be quite arbitrary but the basic idea is easy to understand: when there are more online hosts, the traffic load is heavier, so the token rate is lower. However, in the calculator application, the token bucket parameters only depend on the link bandwidth. Traffic load is not considered (actually it has been taken into consideration) and the equation has only one dependency.

We also noticed that a lot of users and router manufactures are against downstream traffic. An example is in the support page of Netgear routers:

http://kb.netgear.com/app/answers/detail/a_id/24266/~/how-to-enable-quality-of-service-%28qos%29-on-routers-with-the-genie-user-interface

In this page, we can only find options about tx traffic control (traffic shaping). For tx traffic, we have full control over the packets, and we can configure priority queues and fair queues to improve quality of service, which is relatively easy.

For rx traffic, we don't have direct control over the traffic, but traffic control is still possible. We believe that the negative options will disappear as related research and real-world testing continues.

=== Open-source Firmwares and Script Generators ===

|| *Target* || *Date* || *Shaping* || *Policing* || *Buffer Size* || *Path* ||
|| Tomato 1.28 || June 28, 2010 || - || - || max(49ms, 6.25 KB) || /src/router/rc/qos.c ||
|| DD-WRT HTB rev 20939 || March 15, 2013 || - || - || sfq (128p) / codel (1000p) / fq_codel (10240p) || /src/router/iproute2/svqos.htb ||
|| DD-WRT HFSC rev 20939 || March 15, 2013 || - || - || sfq (128p) / codel (1000p) / fq_codel (10240p) || /src/router/iproute2/svqos.hfsc ||
|| OpenWRT 12.09 || April 25, 2013 || - || - || fq_codel (10240p) || /package/qos-scripts ||
|| WRT54 Script Generator 1.02 || 2007 || - || - || sfq (128p) / default (1000p) || - ||

<font color="#0068b7">*This is the most important category.*</font>

When users want to optimize their home networks, most of them will find that there's limited functionality available in factory firmwares, and then they begin to try open-source firmwares like DD-WRT, OpenWRT, Tomato, etc. The users who enjoy flashing routers and trying different open-source firmwares are only a small fraction of the entire user group, and they are often referred to as "geeks".

As a result, most of the discussions appear in a few technical blogs and forums that are not well known by most ordinary users.

Most "geeks" simply use the features provided in the web interface of different firmwares. That's why we consider it the most important. However, there seem to be a lot of inappropriate settings of the buffer size.

For example, in earlier version of DD-WRT, when the user enables downstream bandwidth limiting, and then added some priority classes (e.g., Premium, Express, Standard, or Bulk), an sfq is attached to each htb leaf class automatically. As each sfq has a buffer of 128 packets, the entire bufffer may be 512 packets or more.

In the "WRT54 Script Generator" known by many Linux router players, it's possible to create an htb leaf node for each user (identified by IP or MAC address). Users can either attach an sfq to each htb leaf, or just leave it alone. For a network with n users, the former choice leads to a total buffer of 128 `*` n packets, and for the latter, 1000 `*` n packets. Clearly, it does not make sense to configure so large a buffer. When different users start bulk transfers at the same time, the htb has to absorb too many packets before taking a drop, which leads to significant delay and jitter.

Similarly, for downstream traffic, the deployment of codel and fq_codel may lead to large jitter due to bursts of traffic.

The Tomato firmware police traffic in a smarter way. The buffer size of its setting is 49ms (with a lower bound of 6.25 KB), which grows linearly when the token rate increases. The basic idea that a higher rate needs a larger buffer is correct, but the equation needs to be verified.

=== Forum Posts ===

|| *Title* || *Website* || *Shaping* || *Policing* || *Buffer Size* || *In Reply* ||
|| [http://www.dd-wrt.com/phpBB2/viewtopic.php?t=3100 My "custom" QoS that really works] || www.dd-wrt.com || 85% || 85% || 200p, 700p, 1000p || ||
|| [http://www.dd-wrt.com/phpBB2/viewtopic.php?p=905429 R7000 & QoS - recommended settings for games/media strea] || www.dd-wrt.com || 80% - 95% || 80% - 95% || fq_codel (10240p) || ||
|| [http://www.dd-wrt.com/phpBB2/viewtopic.php?p=174421 Vonage and QoS finally figured out!!] || www.dd-wrt.com || 80% || 90% || sfq (128p) || ||
|| [http://www.linksysinfo.org/index.php?threads/using-qos-tutorial-and-discussion.28349/ Using QOS - Tutorial and discussion] || www.linksysinfo.org || 85% || 66% - 80% || - || ||
|| [http://ask.slashdot.org/story/08/06/26/2156201/can-any-router-guarantee-bandwidth-for-voip Can Any Router Guarantee Bandwidth For VoIP?] || ask.slashdot.org || 75% - 90% || - || - || ||
|| [http://tech.slashdot.org/story/08/06/01/2225228/why-bittorrent-causes-latency-and-how-to-fix-it Why BitTorrent Causes Latency and How To Fix It] || tech.slashdot.org || - || - || sfq (128p) / default (1000p) || Yes ||
|| [http://www.dslreports.com/forum/r19838037-Does-setting-QoS-to-80-of-bandwidth-limit-maximum-speed- Does setting QoS to 80% of bandwidth limit maximum speed?] || www.dslreports.com || 80% || - || - || ||
|| [http://www.dslreports.com/forum/r26109676-Asterisk-QoS-question-with-SpeedBoost-on-Rogers Asterisk: QoS question with SpeedBoost on Rogers] || www.dslreports.com || 80% || 80% || - || ||
|| [http://forums.whirlpool.net.au/archive/1746121 7800N QoS Rules] || forums.whirlpool.net.au || 80% || - || - || ||
|| [http://forums.anandtech.com/showthread.php?t=2342285 Any consumer router than can handle 100mbps+ with QoS on?] || forums.anandtech.com || - || 80% || - || ||
|| [http://lifehacker.com/5710804/improve-your-bandwidth-heavy-activities-with-router-tweaks Improve Your Bandwidth-Heavy Activities with Router Tweaks] || lifehacker.com || 90% - 95% || - || - || Yes ||
|| [https://www.gargoyle-router.com/phpbb/viewtopic.php?f=5&t=2049 QOS just for p2p downloads/streaming?] || www.gargoyle-router.com || 90% || above 75% || - || Yes ||
|| [http://forums.smallnetbuilder.com/showthread.php?t=7809 Guide for QoS?] || forums.smallnetbuilder.com || 70% || - || - || ||
|| [http://www.actuarialoutpost.com/actuarial_discussion_forum/archive/index.php/t-241559.html Voip and QOS] || www.actuarialoutpost.com || 80% - 90% || 80% - 90% || - || Yes ||
|| [http://forums.dlink.com/index.php?action=printpage;topic=46039.0 Properly setup QOS engine] || forums.dlink.com || 80% || - || - || ||
|| [http://www.ulop.net/forum/4-lounge/558495-qos-settings-for-wireless-router-adp-wizard-intex qos settings for Wireless Router/Adp WIZARD INTEX] || www.ulop.net || 80% || 80% || - || Yes ||
|| [http://www.myopenrouter.com/forum/thread/31357/QoS-is-not-functioning-correctly./ QoS is not functioning correctly.] || www.myopenrouter.com || - || 80% || - || ||
|| [http://www.phoneservicesupport.com/mj-actiontec-router-qos-t12036.html MJ & Actiontec Router QOS ] || www.phoneservicesupport.com || 80% || 80% || - || Yes ||
|| [http://community.linksys.com/t5/Wireless-Routers/Request-suggestion-to-improve-WISP-Ooma-VOIP-call-quality-using/td-p/534448 Request suggestion to improve WISP Ooma VOIP call quality using a Linksys WRT54G v5?] || community.linksys.com || 80% || - || - || ||
|| [http://mybroadband.co.za/vb/showthread.php/545501-Skype-and-QOS  Skype and QOS] || mybroadband.co.za || 80% || 80% || sfq (128p) || Yes ||
|| [http://www.rage3d.com/board/showthread.php?t=33873855 QoS work for any of you?] || www.rage3d.com || 80% || - || - || ||
|| [http://forums.overclockers.com.au/showthread.php?t=441200 Engin VOIP + Billion 7402 + Help me setup QoS so my calls arn't choppy.] || forums.overclockers.com.au || 80% || 80% || - || Yes ||
|| [http://forums.na.leagueoflegends.com/board/showthread.php?t=97116 Slight lag when running QoS/ Tomato/DD-WRT!] || forums.na.leagueoflegends.com || 80% || 80% || - || Yes ||
|| [http://tomato.groov.pl/?page_id=334&bugerator_nav=display&bug_project=1&issue=256 QOS Speed Limits] || tomato.groov.pl || 80% || 80% || max(49ms, 6.25 KB) || Yes ||
|| [http://forums.stevehoffman.tv/threads/sharing-an-internet-connection-evenly-via-a-linksys-router.203605/ Sharing an Internet Connection Evenly Via a Linksys Router] || forums.stevehoffman.tv || 80% || - || - || Yes ||
|| [http://hardforum.com/showthread.php?t=1454426 Should I use QoS on my home router? Is it worth it?] || hardforum.com || 80% - 90% || 80% - 90% || max(49ms, 6.25 KB) || ||
|| [http://www.vonage-forum.com/Here_are_the_QoS_settings_I_use_on_my_Actiontec_with_VZ_FiOS_Go_to_the_QoS_tab_Select-post-98631.html Here are the QoS settings I use on my Actiontec with VZ FiOS. Go to the QoS tab. Select] || www.vonage-forum.com || 80% || 80% || - || ||
|| [http://serverfault.com/questions/105014/does-anyone-really-understand-how-hfsc-scheduling-in-linux-bsd-works Does anyone really understand how HFSC scheduling in Linux/BSD works?] || serverfault.com || 70% - 80% || 70% - 80% || - || Yes ||
|| [http://pbxinaflash.com/community/index.php?threads/best-way-to-go-about-qos-router-settings.8732/ Best way to go about QOS router settings?] || pbxinaflash.com || 80% - 90% || 80% - 90% || - || Yes ||
|| [http://forums.plugpbx.org/index.php?topic=251.0;wap2 Correct Tomato QOS Settings] || forums.plugpbx.org || below 85% || below 85% || max(49ms, 6.25 KB) || Yes ||
|| [http://forums.untangle.com/networking/6106-qos-voip-working.html QOS and VOIP - working?] || forums.untangle.com || 95% || 80% || - || Yes ||
|| [http://www.spinics.net/lists/lartc/msg20832.html Re: Help needed with HTB] || www.spinics.net || 80% || - || - || ||
|| [http://www.spinics.net/lists/lartc/msg21740.html RE: Prioritizing VOIP traffic without sacrificing throughput] || www.spinics.net || 80% || 80% || - || || 
|| [http://www.spinics.net/lists/lartc/msg13594.html HTB mpu and overhead settings for PPPoE ADSL?] || www.spinics.net || 80% || - || - || ||
|| [http://mailman.ds9a.nl/pipermail/lartc/2004q4/014257.html SEPARATING VOIP AND SURFING] || mailman.ds9a.nl || 80% || - || - || ||
|| [https://forum.openwrt.org/viewtopic.php?id=4112 A qos script that really works!] || forum.openwrt.org || 93% || 89% || 1s || ||

=== Wiki Pages ===

|| *Title* || *Website* || *Shaping* || *Policing* || *Buffer Size* ||
|| [http://www.dd-wrt.com/wiki/index.php/QoS Quality of Service] || www.dd-wrt.com || 80% - 95% || 80% - 95% || sfq (128p) ||
|| [http://www.dd-wrt.com/wiki/index.php/Peer-to-Peer_%28P2P%29_Throttling Peer-to-Peer (P2P) Throttling] || www.dd-wrt.com || 80% - 95% || - || - ||
|| [http://tomatousb.org/tut:using-tomato-s-qos-system Using Tomato's QOS System] || tomatousb.org || 85% || 66% - 80% || sfq (128p) ||
|| [http://www.voipmechanic.com/setting-qos-voip-linksys.htm Configure QoS for VoIP on your router for better voice quality] || www.voipmachanic.com || 90% || - || - ||
|| [http://vonage.nmhoy.net/qos.html Implementing QoS] || vonage.nmhoy.net || 90% - 95 || - || - ||
|| [http://www.wi-fiplanet.com/tutorials/article.php/3800416 How to: Manage Traffic Using Tomato and QoS] || www.wi-fiplanet.com || 90% || - || max(49ms, 6.25 KB) ||
|| [http://www.voipmechanic.com/ddwrt-tomato.htm Tomato QoS settings on your VoIP router] || www.voipmechanic.com || 80% - 90% || - || - ||
|| [http://help.close.io/customer/portal/articles/1286697-qos-settings QoS Setup] || help.close.io || 80% || 80% || - ||
|| [http://wiki.mikrotik.com/wiki/NetworkPro_on_Quality_of_Service NetworkPro on Quality of Service] || wiki.mikrotik.com || above 85% || above 85% || - ||
|| [https://www2.lancom.de/kb.nsf/1276/07F4E77B74CECC98C12578A2004077D2 Setting up a maximum bandwidth (firewall/QoS) in a LANCOM router] || www2.lancom.de || 80% || 80% || - ||
|| [http://help.fonality.com/index.php?title=TroubleshootingFAQ/Connect/Setup/What_is_QoS_and_how_do_I_use_it%3F What is QoS and how do I use it?] || help.fonality.com || below 80% || below 80% || - ||
|| [http://www.increasebroadbandspeed.co.uk/draytek-2920 DrayTek 2920 load balancing router] || www.increasebroadbandspeed.co.uk || 80% || 80% || - ||
|| [http://lartc.org/howto/lartc.cookbook.ultimate-tc.html The Ultimate Traffic Conditioner: Low Latency, Fast Up & Downloads] || lartc.org || 90% || 80% || 10 KB ||

=== Blogs ===

|| *Title* || *Website* || *Shaping* || *Policing* || *Buffer Size* ||
|| [http://www.howtogeek.com/75660/the-beginners-guide-to-qos-on-your-router/ The Beginner’s Guide to Using QoS (Quality of Service) on Your Router] || www.howtogeek.com || 85% - 95% || 85% - 95% || - ||
|| [http://lifehacker.com/326543/ensure-a-fast-internet-connection-when-you-need-it Ensure a Fast Internet Connection When You Need It] || lifehacker.com || 85% || 85% || sfq (128p) ||
|| [http://dailybeagle.com/2009/09/the-basics-configure-quality-of-service-qos-for-voip/ The Basics: Configure Quality of Service (QoS) for VoIP] || dailybeagle.com || 90% - 95% || 80% - 90% || max(49ms, 6.25 KB) ||
|| [http://chillingsilence.wordpress.com/2009/11/21/quick-and-easy-qos-with-tomato/ Quick and Easy QoS with Tomato] || chillingsilence.wordpress.com || 94% || 90% || max(49ms, 6.25 KB) ||
|| [http://www.howtogeek.com/70659/how-to-give-your-computers-network-traffic-priority-with-dd-wrt/ How to Prioritize Your Network Traffic with DD-WRT] || www.howtogeek.com || 80% - 95% || 80% - 100% || sfq (128p) ||
|| [https://calomel.org/pf_hfsc.html Hierarchical Fair Service Curve (HFSC)] || calomel.org || 97% || - || 500p ||
|| [http://rtn66u.blogspot.jp/2013/02/traffic-manager-qos.html Traffic Manager - QOS] || rtn66u.blogspot.jp || 70% - 80% || 70% - 80% || - ||

=== Source Code ===

|| *Title* || *Website* || *Shaping* || *Policing* || *Buffer Size* || *Notes* ||
|| [https://github.com/zcecc22/qos-nxt qos-nxt] || github.com || 80% || 80% || 500p || ||
|| [http://www.robbrewer.me/projects/openwrt/ Rob Brewer's Firewall and QoS Scripts for OpenWRT] || www.robbrewer.me || 90% || - || 150 KB || ||
|| [http://www.dslreports.com/forum/r24894358-Tomato-A-script-for-QOS A script for QOS] || www.dslreports.com || - || - || sfq (128p) || ||
|| [http://www.dslreports.com/forum/r20708380-Dedicated-VOIP-bandwidth-WRT54-Script-Generator Dedicated VOIP bandwidth - WRT54 Script Generator] || www.dslreports.com || - || - || sfq (128p) || ||
|| [http://www.rooot.net/en/geek-stuff/openwrt/1-qos-openwrt.html QoS for OpenWrt] || www.rooot.net || - || - || 200 KB || ||
|| [http://www.linksysinfo.org/index.php?threads/an-interesting-qos-script-example.36542/ An Interesting QOS script example] || www.linksysinfo.org || 76% || 76% || default (1000p) || ||
|| [http://pastebin.com/cNQ2DxEN QoS script for DD-WRT from Alex Rice's blog] || pastbin.com || 85% - 90% || - || - || ||
|| [http://lartc.org/howto/lartc.cookbook.fullnat.intro.html 15.10. Example of a full nat solution with QoS] || lartc.org || 80% || - || - || ||
|| [http://www.docunext.com/blog/2006/08/qos-script-for-openwrt.html QOS Script for OpenWRT] || www.docunext.com || 81% || 95% || 10 KB || ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=32202 发一个双wan的智能QOS脚本（2010年6月17日更新附单wan）] || bbs.dualwan.cn || - || 91% || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=20122 智能QOS脚本横空出世] || bbs.dualwan.cn || - || - || default (1000p) || (in Chinese, imq0 / class 1:255) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=110802 对zhoutao0712 qosv2.0 脚本的增强 第四次更新] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=148372 技术研究 QOS：周大师V4.0和cmt1978 等脚本的综合修改试用版0.1] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=22482 P2P惩罚 QOS脚本 V4.0] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=120012 双wan极速飞驰版QOS脚本，v0.5] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=20752 智能QOS脚本修改版] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=12192 小包优先+WEB优先+IP限速+连接数限制 的脚本] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=158102 儿童节发布K26支持任意网段限速QOS脚本，打得openwrt满地找牙] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=152972 发布K26 QOS脚本，打压openwrt势力] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=188892 ADSL QOS脚本 V1.1] || bbs.dualwan.cn || - || - || sfq (128p) || (in Chinese) ||
|| [http://bbs.dualwan.cn/viewthread.php?tid=14442 小包优先+web优先+游戏爆发+单IP限速+连接数限制 QOS脚本V2.0] || bbs.dualwan.cn || 78% || 88% || sfq (128p) || (in Chinese) ||

=== Online Documents ===

|| *Title* || *Website* || *Shaping* || *Policing* || *Buffer Size* || *Page* ||
|| [https://www.synety.com/support/kb/kb_file.php?id=00PG000000FBkQ7MAL Setting up a DrayTek 2830n for SYNETY VoIP QoS] || www.synety.com || 80% || 80% || - || 2 ||